主从切换的方法：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费时费力，并且还会造成一段时间内服务不可用，所以这并不是一种推荐的方式，我们更多的时候会考虑**
哨兵模式**

### 概述

哨兵模式是一种特殊的模式，首先，`Redis`提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是哨兵通过发送命令，等待`Redis
`服务器响应，从而监控运行的多个`Redis`实例。

**哨兵的作用**

- 通过发送命令，让`Redis`服务器返回监控其运行状态，包括主服务器和从服务器
- 当哨兵检测到主服务器宕机，会自动将从服务器切换成主服务器，然后通过发布订阅模式通知其他的从服务器，修改配置文件，让他们切换主机

如果只有一个哨兵进程对`Redis`服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控，各个哨兵之间还会进行监控，这就形成了多哨兵模式。

**故障切换**

假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行`failover`过程，仅仅是哨兵1 主观的认为主服务器不可用，这个现象称为**主观下线**
，当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行`failover`
操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主服务器，这个过程称为**客观下线**，这样对于客户端而言，一切都是透明的。

**测试**

测试的模式为一主二从

1、配置哨兵配置文件`sentinel.conf`

```bash
# sentinel monitor 被监控的名字 host port 1
# 最后的数字1，代表主机挂了，由一台从机发起投票，票数最多的，就会称为主机
sentinel monitor myredis 127.0.0.1 6379 1
```

2、启动哨兵

```bash
redis-sentinel config/sentinel.conf
```

如果之前宕机的主机恢复了，只能归并到新的主机下，作为从机，这就是哨兵模式的规则。
`Redis`是基于内存的数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。

#### RDB（Redis DataBase）

在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是`Snapshot`，它恢复时是将快照文件直接读取到内存中。

`Redis`会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时的文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何`IO`操作的，这就确保了极高的性能，如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那`RDB`方式要比`AOF`方式更加的高效，`RDB`的缺点是最后一次持久化后的数据可能会丢失。

**触发机制**

- `save`的规则满足
- 执行了`flushall`
- 退出`Redis`

备份就会自动生成一个`dump.rdb`

**恢复rdb文件**

只需要将rdb文件放在我们的redis启动目录就可以，redis启动的时候会自动检查dump.rdb恢复其中的数据

```bash
# 查看目录
config get dir
1) "dir"
2) "/usr/local/bin"
```

如果再这个目录下存在dump.rdb文件，那么启动的时候redis就会自动恢复其中的数据

**优点**

- 适合大规模数据的恢复
- 对数据的完整性不高

**缺点**

- 需要一定的时间间隔进程操作，如果redis意外宕机了，最后一次修改的数据就没有了
- fork子进程的时候会占用一定的内存空间

#### AOF(Append Only File)

将我们所有的操作都记录下来形成历史文件，恢复的时候会将这个历史文件中的命令重新执行一次。

以日志的形式来记录每个写操作，将`Redis`执行过的所有指令记录下来，只许追加文件不许改写文件，`Redis`启动时会读取该文件重新构建数据，即`Redis`重启时会加载读取该文件，将记录的操作命令从新执行一遍

```bash
# 开启aof
appendonly yes
# 指定aof文件的名称
appendonlyfilename "appendonly.aof"
```

`aof`默认是不开启的，我们需要手动配置，即将`appendonly`的值修改为`yes`就开启了，修改完配置后需要重启`Redis`即可生效

注意：如果`.aof`文件中的内容出现错误，`Redis`无法启动成功，我们可以使用`redis-check-aof`这个工具对其进行修复：`redis-check-aof --fix`，修复成功后可以成功启动
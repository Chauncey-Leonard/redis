### 一、缓存穿透

#### 描述

缓存穿透是指在缓存系统没有查询到数据，用户大量直接请求数据库，导致数据库压力过大甚至崩溃

#### 缓存处理流程

前端发起请求，后台先从缓存中获取数据，取到直接返回结果；缓存中不存在时，将从数据库中获取数据，获取到数据更新缓存，并返回结果，如果数据库中也没有，则直接返回空结果

#### 解决方案

- 接口层增加校验，如用户鉴权校验，id做基础校验，id小于等于0的直接拦截
- 对于一定不存在的数据，即从缓存和数据库中都获取不到数据，我们可以将`key-value`对应的存为`key-null`,
  并将缓存的过期时间设置短一点，这样可以防止攻击用户反复使用同一个id暴力攻击

### 二、缓存击穿

#### 描述

缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间过期），这时由于并发用户特别多，同时读取缓存没有获取到数据，又同时请求数据库，导致数据库的压力瞬间增大

#### 解决方案

- 设置热点数据永不过期
- 加互斥锁，互斥锁参考代码如下：

```java
public static String getData(String key) throws InterruptedException{
    // 从缓存中获取数据
    String result = getDataFromRedis(key);
    // 缓存中不存在
    if(result == null) {
        // 获取锁，获取成功则去数据库获取数据
        if(reenLock.tryLock()) {
            result = getDataFromMysql(key);
            // 如果数据存在，则更新缓存
            if(result != null) {
                setDataToCache(key, result);
            }   
            // 释放锁
            reenLock.unlock();
        } else { // 获取锁失败
            // 休眠100ms重新再获取数据
            Thread.sleep(100);
            result = getData(key);
        }    
    }
    
    return result;
}
```

### 三、缓存雪崩

#### 描述

缓存雪崩是指缓存中的数据大批量的过期，而查询数据量巨大，引起数据库压力过大甚至宕机，和缓存击穿不同的是，缓存击穿指的是并发查询同一条数据，而缓存雪崩是不同的数据都过期，导致全部都需要去数据库查询

#### 解决方案

- 为不同的缓存数据设置不同的过期时间，即可防止同一时间大量数据过期现象发生
- 如果缓存数据库是分布式部署的，将热点数据均匀分布在不同的缓存数据库中
- 热点数据设置永不过期